[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=14cc468c-f0f5-4e9a-8c08-779bebf0b69d
Description=PDMTool
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FormGlobal
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
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


[Script]
//////////////////////////////////
// Global Flag
Global gRunFlag
gRunFlag = false

//////////////////////////////////
// Init Event
Event FormGlobal.Load
	Const PDMTOOL_VERSION = "1.0.0"
	Const DEIVCE_LIST_NUM = 2
	Const DEVICE_ID_INVALID = -1
	Const DEVICE_ID_R48G = 0
	Const DEVICE_ID_R49P = 1
	Const DEVICE_ID_LIST = "R48G|R49P"
	Const TIPS_SELECT_FILE = "请选择要上PDM的.img文件"
	
	Const DEVICE_R48G_WORD_TEMPLATE_PATH = "./"
	Const DEVICE_R48G_WORD_TEMPLATE_LIST = "工程文件发行.doc|Mac烧写工具.doc"
	
	SetPDMToolVersion(PDMTOOL_VERSION)
	SetDeviceList(DEVICE_ID_LIST)
	ResetAll
End Event

//////////////////////////////////
// Click Event
Event FormGlobal.BtnClearLog.Click
	ClearLog
End Event

Event FormGlobal.BtnOK.Click
	Dim checkRes
	checkRes = true
	checkRes = CheckDevice and checkRes
	checkRes = CheckSelectedFile and checkRes
	
	If false = checkRes Then
		TraceLog "检测失败, 请正确填写PDM所需信息"
	Else 
		TraceLog "生成中, 请稍后..."
		Generate
	End If
	
End Event

Event FormGlobal.BtnReset.Click
	ResetAll
End Event

Event FormGlobal.BtnSelectFile.Click
	Dim filePath
	filePath = Plugin.File.SelectFile()
	If filePath <> "" Then 
		SetDeviceNormal
		SetSelectedFile(filePath)
	End If
End Event

//////////////////////////////////
// Select Event
Event FormGlobal.ComboxDevice.SelectChange
	SetDeviceNormal 
	ResetSelecteFile
	If IsValidDeviceIndex Then 
		ShowSelectFile
		SetGroupBoxInfo (GetDeviceName)
		
		// 根据机型, 加载对应布局
		Dim deviceId
		deviceId = GetDeviceIndex
	End If
End Event


//////////////////////////////////
// Check Function
Function CheckDevice()
	If IsValidDeviceIndex Then
		SetDeviceOK 
		CheckDevice = true
	Else 
		TraceLog "机型信息非法"
		SetDeviceErr 
		CheckDevice = false
	End If
End Function

Function CheckSelectedFile()
	If IsValidSelectedFile Then 
		SetSelectedFileOK 
		CheckSelectedFile = true
	Else 
		TraceLog "请选择正确的文件"
		SetSelectedFileErr 
		CheckSelectedFile = false
	End If
End Function

//////////////////////////////////
// Version Relations Function
Function SetPDMToolVersion(version)
	FormGlobal.LabelVersion.Caption = "版本: " + version
End Function

//////////////////////////////////
// Button Relations Function
Function EnableBtnOK()
	FormGlobal.BtnOK.Enabled = true
End Function

Function DisableBtnOK()
	FormGlobal.BtnOK.Enabled = false
End Function

Function EnableBtnReset()
	FormGlobal.BtnReset.Enabled = true
End Function

Function DisableBtnReset()
	FormGlobal.BtnReset.Enabled = false
End Function

Function EnableBtnSelectFile()
	FormGlobal.BtnSelectFile.Enabled = true
End Function

Function DisableBtnSelectFile()
	FormGlobal.BtnSelectFile.Enabled = false
End Function

//////////////////////////////////
// Device Relations Function
Function SetDeviceList(deviceList)
	FormGlobal.ComboxDevice.List = deviceList
End Function

Function GetDeviceIndex()
	GetDeviceIndex = FormGlobal.ComboxDevice.ListIndex
End Function

Function IsValidDeviceIndex()
	Dim deviceIndex
	deviceIndex = FormGlobal.ComboxDevice.ListIndex
	If 0 > deviceIndex Then
		IsValidDeviceIndex = false
	ElseIf DEIVCE_LIST_NUM <= deviceIndex Then
		IsValidDeviceIndex = false
	Else 
		IsValidDeviceIndex = true
	End If
End Function

Function GetDeviceName()
	Dim deviceList
	deviceList = Split(FormGlobal.ComboxDevice.List, "|")
	GetDeviceName = deviceList(FormGlobal.ComboxDevice.ListIndex)
End Function

Function SetDeviceOK()
	FormGlobal.ComboxDevice.NormalColor = "1BA154"
End Function

Function SetDeviceErr()
	FormGlobal.ComboxDevice.NormalColor = "0000FF"
End Function

Function SetDeviceNormal()
	FormGlobal.ComboxDevice.NormalColor = "A0A0A4"
End Function

Function ResetDevice()
	SetDeviceNormal 
	
	FormGlobal.ComboxDevice.ListIndex = DEVICE_ID_INVALID
End Function

//////////////////////////////////
// GroupBox Relations Function
Function SetGroupBoxInfo(deviceName)
	FormGlobal.GroupBoxInfo.Caption = "请填写" + deviceName + "机型相关信息"
End Function

Function ResetGroupBoxInfo()
	FormGlobal.GroupBoxInfo.Caption = "请先选择机型"
End Function

//////////////////////////////////
// SelectFile Relations Function
Function ResetSelecteFile()
	SetSelectedFileNormal 
	
	FormGlobal.LabelSelectedFile.Caption = TIPS_SELECT_FILE
	FormGlobal.LabelSelectedFile.Visible = false
	FormGlobal.BtnSelectFile.Visible = false	
End Function

Function ShowSelectFile()
	FormGlobal.LabelSelectedFile.Visible = true
	FormGlobal.BtnSelectFile.Visible = true
End Function

Function SetSelectedFile(filePath)
	FormGlobal.LabelSelectedFile.Caption = filePath
End Function

Function GetSelectedFile()
	GetSelectedFile = FormGlobal.LabelSelectedFile.Caption
End Function

Function IsValidSelectedFile()
	Dim filePath
	filePath = GetSelectedFile
	If filePath = TIPS_SELECT_FILE Then 
		IsValidSelectedFile = false
	ElseIf false = Plugin.File.IsFileExist(filePath) Then
		IsValidSelectedFile = false
	ElseIf false = IsValidDeviceIndex Then 
		IsValidSelectedFile = false	
	Else 
		// 增加正则匹配文件名是否合法
		Dim fileName, deviceNameL
		fileName = GetFileName(filePath)
		deviceNameL = LCase(GetDeviceName)

		Dim regEx, matches, matched
		Set regEx = New RegExp
		regEx.Pattern = "^" + deviceNameL + "-([0-9]{1,4}\.){3}[0-9]{1,4}-[0-9a-zA-Z]{1,}.img$"
		
		Set matches = regEx.Execute(fileName)
		matched = matches(0)
		If matched = fileName Then 
			IsValidSelectedFile = true
		Else 
			IsValidSelectedFile = false	
		End If
	End If
End Function

Function SetSelectedFileOK()
	FormGlobal.LabelSelectedFile.TextColor = "1BA154"
End Function

Function SetSelectedFileErr()
	FormGlobal.LabelSelectedFile.TextColor = "0000FF"
End Function

Function SetSelectedFileNormal()
	FormGlobal.LabelSelectedFile.TextColor = "808080"
End Function

//////////////////////////////////
// Word Relations Function
Function GenerateWordDoc(outputPath, fileName, fileMD5, fileSizeReadableMB, fileSizeReadableByte, model, version, oem)
	Dim deviceID, fileList, filePath
	deviceID = GetDeviceIndex()
	Select Case deviceID
		Case DEVICE_ID_R48G
			filePath = DEVICE_R48G_WORD_TEMPLATE_PATH
			fileList = Split(DEVICE_R48G_WORD_TEMPLATE_LIST, "|")
		
		Case DEVICE_ID_R49P
			// Unsupport now
			GenerateWordDoc = false
			Exit Function
			
		Case Else
			GenerateWordDoc = false
			Exit Function
	End Select

	TraceLog "fileList - " + fileList
	Dim wordFileFd
	For i = 0 To UBound(fileList)
		// 合法性检查
		If false = Plugin.File.IsFileExist(filePath + fileList(i)) Then 
			TraceLog "模板文件[" + filePath + fileList(i) + "]不存在!"
			GenerateWordDoc = false
			Exit Function
		End If
		
		TraceLog "操作..." + outputPath + fileList(i)
		
		// 复制文件
		Plugin.File.CopyFile filePath + fileList(i), outputPath + fileList(i)
		
		// 替换关键字
		wordFileFd = Plugin.LazyOffice.WordOpen(outputPath + fileList(i))
		Plugin.LazyOffice.WordFind "$fileName", fileName
		Plugin.LazyOffice.WordFind "$fileMD5", fileMD5
		Plugin.LazyOffice.WordFind "$fileSizeReadableMB", fileSizeReadableMB
		Plugin.LazyOffice.WordFind "$fileSizeReadableByte", fileSizeReadableByte
		Plugin.LazyOffice.WordFind "$model", model
		Plugin.LazyOffice.WordFind "$version", version
		Plugin.LazyOffice.WordFind "$oem", oem
		
		Plugin.LazyOffice.WordClose(wordFileFd)
	Next
	
	GenerateWordDoc = true
End Function

Function GenerateWordDocInR48G(outputPath, fileName, fileMD5, fileSizeReadableMB, fileSizeReadableByte, model, version, oem)
	Dim wordFile, fileList, curFile
	fileList = Split(FormGlobal.ComboxDevice.List, "|")
	wordFile = Plugin.LazyOffice.WordOpen(filePath)

	Plugin.LazyOffice.WordClose (wordFile)	
End Function

Function GenerateWordDocInR49P(outputPath, fileName, fileMD5, fileSizeReadableMB, fileSizeReadableByte, model, version, oem)
	// Unsupport now
	GenerateWordDocInR49P = false
End Function

//////////////////////////////////
// Common Function
Function ClearLog()
	FormGlobal.InputLog.text = ""
End Function

Function TraceLog(logContent)
	Dim logline
	logline = "日志" + "[" + CStr(Hour(now)) + ":" + CStr(Minute(now)) + ":" + CStr(Second(now)) + "]"
    logline = logline + ": " + CStr(logContent)

    FormGlobal.InputLog.text = FormGlobal.InputLog.text + vbcrlf + logline
End Function

Function Round(value, keep)
	If 0 <> InStr(value, ".") Then
    	Dim integerPart, decimalPart
    	integerPart = split(value, ".")(0)
    	decimalPart = split(value, ".")(1)
    	If Len(decimalPart) < keep Then 
        	Round = integerPart & "." & String(keep - Len(decimalPart), "0")
    	ElseIf Len(decimalPart) = keep Then   
        	Round = value
    	ElseIf Len(decimalPart) > keep Then
    		Dim tmpLen, tmpValue
        	If Mid(decimalPart, keep + 1, 1) >= 5 Then 
            	If Len(decimalPart) = 1 Then 
                	Round = integerPart + 1
            	Else 
            		tmpLen = Len(Left(decimalPart, keep))
            		tmpValue = Left(decimalPart, keep) + 1
            		If (Len(tmpValue) <> tmpLen) Then 
            			tmpValue = String(tmpLen - Len(tmpValue), "0") & tmpValue
            		End If
                	Round = integerPart & "." & tmpValue
            	End If
        	Else 
            	If Len(decimalPart) = 1 Then 
                	Round = integerPart
            	Else 
            		tmpLen = Len(Left(decimalPart, keep))
            		tmpValue = Left(decimalPart, keep) + 1
            		If (Len(tmpValue) <> tmpValue) Then 
            			tmpValue = String(tmpLen - Len(tmpValue), "0") & tmpValue
            		End If
                	Round = integerPart & "." & tmpValue
            	End If
        	End If
    	End If
    Else 
    	Round = value & "." & String(keep, "0")
    End If
End Function

Function TrimBytes(value)
	Dim comma, num, lenth
	Dim leftPart, rightPart
	lenth = Len(value)
	
	If lenth > 3 Then 
		For i = 3 To lenth step 3	
		leftPart = Left(value, lenth - i + ((i-3)/3))
		rightPart = right(value, i + ((i-3)/3))
		value = leftPart & "," & rightPart
		Next	
	End If
	
	TrimBytes = CStr(value)
End Function

Function GetFileName(filePath)
	Dim fso
	Set fso = CreateObject("Scripting.FileSystemObject")
  	GetFileName = fso.GetFileName(filePath)
End Function

Function GetModel(fileName)
	Dim regEx, matches
	Set regEx = New RegExp
	regEx.Pattern = "^r[4][89]"
	Set matches = regEx.Execute(fileName)
	GetModel = matches(0)
End Function

Function GetVersion(fileName)
	Dim regEx, matches
	Set regEx = New RegExp
	regEx.Pattern = "([0-9]{1,4}\.){3}[0-9]{1,4}"
	Set matches = regEx.Execute(fileName)
	GetVersion = matches(0)
End Function

Function GetOem(fileName)
	Dim regEx, matches
	Set regEx = New RegExp
	regEx.Pattern = "-[0-9a-zA-Z]{1,}.img"
	Set matches = regEx.Execute(fileName)
	
	regEx.Pattern = "[0-9a-zA-Z]{1,}"
	Set matches = regEx.Execute(matches(0))
	
	GetOem = matches(0)
End Function

Function ResetAll()
	ResetDevice 
	ResetGroupBoxInfo 
	ResetSelecteFile
End Function

Function Generate()
	If true = gRunFlag Then 
		TraceLog "正在生成中..."
	Else 
		gRunFlag = true
		BeginThread DoGenerate
	End If
End Function

//////////////////////////////////
// Common Sub, for Thread
Sub DoGenerate()
	DisableBtnOK 
	DisableBtnReset 
	DisableBtnSelectFile 
		
	Dim filePath, fileName, fileMD5, fileSize, fileSizeReadableByte, fileSizeReadableMB
	filePath = GetSelectedFile
	fileName = GetFileName(filePath)
	fileMD5 = Plugin.Encrypt.Md5File(filePath)
	fileSize = Plugin.File.GetFileLength(filePath)

	fileSizeReadableByte = TrimBytes(fileSize) + " Bytes"
	fileSizeReadableMB = Round(fileSize/1024/1024, 1) + " MB"

	Dim model, version, oem
	model = GetModel(fileName)
	version = GetVersion(fileName)
	oem = GetOem(fileName)
	
	// 信息输出
	TraceLog "文件名称 - " + fileName
	TraceLog "文件路径 - " + filePath
	TraceLog "文件MD5 - " + fileMD5
 	TraceLog "文件大小 - " + fileSizeReadableMB + "(" + fileSizeReadableByte + ")"
 	TraceLog "机型 - " + model
	TraceLog "版本 - " + version
	TraceLog "OEM - " + oem
	
	Dim generateRes
	// 根据模板生成Word文档
	generateRes = GenerateWordDoc("./outputs", fileName, fileMD5, fileSizeReadableMB, fileSizeReadableByte, model, version, oem)
	If false = generateRes Then 
		TraceLog "生成Word文件失败, 请检查模板文件及日志信息!"
		Exit Sub
	End If
	
	// 根据模板生成Excel文档
	
	// 结束
	TraceLog "生成结束, 请审核outputs文件夹中内容!"
	
	EnableBtnSelectFile
	EnableBtnReset 
	EnableBtnOK 
	
	gRunFlag = false
End Sub
	