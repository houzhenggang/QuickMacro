[General]
SyntaxVersion=2
BeginHotkey=0
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=0
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=b0f0aa05-6f4b-44c0-9ca2-d276500ce89a
Description=PDMTool
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FormGlobal
[Relative]
SetupOCXFile=
[Comment]
可以通过修改模板中的关键字, 定制输出内容.
${userName}                     ------      制作者
${modelL}                       ------      机型名称(小写)
${modelU}                       ------      机型名称(大写)
${oemL}                         ------      oem名称(小写)
${oemU}                         ------      oem名称(大写)
${version}                      ------      软件版本号
${hwVersion}                    ------      硬件版本号
${mactoolVersion}               ------      mac工具版本号
${productName}                  ------      产品型号
${productNameTrim}              ------      项目名称(通过产品型号解析出来的)
${boardName}                    ------      主板型号
${fileName}                     ------      img文件名
${fileTime}                     ------      img文件创建时间
${fileMD5}                      ------      img文件MD5
${fileSizeReadableMB}           ------      img文件大小(MB形式)
${fileSizeReadableByte}         ------      img文件大小(字节形式)
${mactoolName}                  ------      mac工具文件名
${mactoolTime}                  ------      mac工具创建时间
${mactoolMD5}                   ------      mac工具MD5
${mactoolSizeReadableMB}        ------      mac工具文件大小(MB形式)
${mactoolSizeReadableByte}      ------      mac工具文件大小(字节形式)
${updateNote}                   ------      img版本更新说明
${timezone}                     ------      时区
${language}                     ------      语言
${mactoolUpdateNote}            ------      mac工具更新说明
${mactoolUpdateReason}          ------      mac工具升级原因

[UIPackage]
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


[Script]
//////////////////////////////////
// Global Flag
Global gRunFlag, gRunPath
gRunFlag = false
Global gKeywordsMapSize, gKeywordsMapSizeByDevice
gKeywordsMapSize = 0
gKeywordsMapSizeByDevice = 0

//////////////////////////////////
// Init Event
Event FormGlobal.Load
    Const PDMTOOL_VERSION = "1.1.0928"
    Const DEIVCE_LIST_NUM = 1
    Const DEVICE_ID_INVALID = - 1 
    Const DEVICE_ID_R47G = 0
    Const DEVICE_ID_R48G = 1
    Const DEVICE_ID_R49P = 2
    Const DEVICE_ID_LIST = "R47G|R48G"
    
    Const UPDATE_REASON_LIST_NUM = 2
    Const UPDATE_REASON_ID_INVALID = -1
    Const UPDATE_REASON_ID_FIRST = 0
    Const UPDATE_REASON_ID_PLAN = 1
    Const UPDATE_REASON_ID_LIST = "首次发行|版本更新, 计划升级"
    
    Const MACTOOL_UPDATE_REASON_LIST_NUM = 2
    Const MACTOOL_UPDATE_REASON_ID_INVALID = -1
    Const MACTOOL_UPDATE_REASON_ID_FIRST = 0
    Const MACTOOL_UPDATE_REASON_ID_PLAN = 1
    Const MACTOOL_UPDATE_REASON_ID_LIST = "首次发行|版本更新, 计划升级"
    
    Const TIPS_SELECT_FILE = "请选择要上PDM的img文件"
    Const TIPS_SELECT_MACTOOL = "请选择要上PDM的mac工具"
    Const TIPS_INPUT_PRODUCT_NAME = "产品型号"
    Const TIPS_INPUT_BOARD_NAME = "主板型号"
    Const TIPS_INPUT_HW_VERSION = "硬件版本"
    Const TIPS_INPUT_TIME_ZONE = "时区"
    Const TIPS_INPUT_LANGUAGE = "语言"
    
    Const TIPS_INPUT_UPDATE_REASON = "版本升级原因"
    Const TIPS_INPUT_UPDATE_NOTE= "版本更新说明"
    Const TIPS_INPUT_MACTOOL_UPDATE_REASON = "mac工具升级原因"
    Const TIPS_INPUT_MACTOOL_UPDATE_NOTE = "mac工具更新说明"
    
    Const TIPS_INPUT_RF_FREQ = "RF频率"
	
    SetPDMToolVersion(PDMTOOL_VERSION)
    SetDeviceList(DEVICE_ID_LIST)
    ResetAll 

    gRunPath = CStr(Plugin.Sys.GetDir(0))
End Event

//////////////////////////////////
// Click Event
Event FormGlobal.BtnClearLog.Click
    ClearLog
End Event

Event FormGlobal.BtnOK.Click
	TraceLog "####################################"
    Dim checkRes
    checkRes = true
    checkRes = CheckDevice and checkRes
    checkRes = CheckSelectedFile and checkRes
    checkRes = CheckSelectedMacTool and checkRes
    checkRes = CheckProductName and checkRes
    checkRes = CheckBoardName and checkRes
    checkRes = CheckHwVersion and checkRes
    checkRes = CheckUpdateNote and checkRes
    checkRes = CheckMactoolUpdateNote and checkRes
    checkRes = CheckTimeZone and checkRes
    checkRes = CheckLanguage and checkRes
    checkRes = CheckUpdateReason and checkRes
    checkRes = CheckMactoolUpdateReason and checkRes

	// 机型相关的检查
	Dim deviceID
    deviceID = GetDeviceIndex
    
    Select Case deviceID
    Case DEVICE_ID_R48G
        checkRes = CheckRfFreq and checkRes

    Case DEVICE_ID_R49P
			
    Case Else
        
    End Select
	
    If false = checkRes Then
        TraceLog "检测失败, 请正确填写PDM所需信息"
    Else 
        TraceLog "生成中, 请稍后..."
        Generate
    End If
	
End Event

Event FormGlobal.BtnReset.Click
    ResetAll
End Event

Event FormGlobal.BtnSelectFile.Click
    Dim filePath
    filePath = Plugin.File.SelectFile()
    If filePath <> "" Then 
        SetSelectedFileNormal
        SetSelectedFile(filePath)
    End If
End Event

Event FormGlobal.BtnSelectMacTool.Click
    Dim filePath
    filePath = Plugin.File.SelectFile()
    If filePath <> "" Then 
        SetSelectedMacToolNormal
        SetSelectedMacTool(filePath)
    End If
End Event

//////////////////////////////////
// Select Event
Event FormGlobal.ComboxDevice.SelectChange
    SetDeviceNormal 
    ResetAllWithoutDevice 
    
    If IsValidDeviceIndex Then 
    	SetGroupBoxInfo (GetDeviceName)
        ShowSelectFile
        ShowSelectMacTool 
        ShowProductName 
        ShowBoardName 
        ShowHwVersion 
        ShowUpdateNote 
        ShowMactoolUpdateNote
        ShowTimeZone 
        ShowLanguage 
        ShowUpdateReason
        ShowMactoolUpdateReason
		
        // 根据机型, 加载对应布局
        Dim deviceID
        deviceID = GetDeviceIndex
        
        Select Case deviceID
        Case DEVICE_ID_R47G
        
    	Case DEVICE_ID_R48G
        	ShowRfFreq
	
    	Case DEVICE_ID_R49P
				
    	Case Else
        	
    	End Select
    End If
End Event


//////////////////////////////////
// Check Function
Function CheckDevice()
    If IsValidDeviceIndex Then
        SetDeviceOK 
        CheckDevice = true
    Else 
        TraceLog "机型信息非法"
        SetDeviceErr 
        CheckDevice = false
    End If
End Function

Function CheckSelectedFile()
    If IsValidSelectedFile Then 
        SetSelectedFileOK 
        CheckSelectedFile = true
    Else 
        TraceLog "请选择正确的img文件"
        SetSelectedFileErr 
        CheckSelectedFile = false
    End If
End Function

Function CheckSelectedMacTool()
    If IsValidSelectedMacTool Then 
        SetSelectedMacToolOK 
        CheckSelectedMacTool = true
    Else 
        TraceLog "请选择正确的mac工具"
        SetSelectedMacToolErr
        CheckSelectedMacTool = false
    End If
End Function

Function CheckProductName()
	If IsValidProductName Then 
        SetProductNameOK 
        CheckProductName = true
    Else 
        TraceLog "产品型号不能为空"
        SetProductNameErr
        CheckProductName = false
    End If
End Function

Function CheckBoardName()
	If IsValidBoardName Then 
        SetBoardNameOK 
        CheckBoardName = true
    Else 
        TraceLog "主板型号不能为空"
        SetBoardNameErr
        CheckBoardName = false
    End If
End Function

Function CheckHwVersion()
	If IsValidHwVersion Then 
        SetHwVersionOK 
        CheckHwVersion = true
    Else 
        TraceLog "硬件型号不能为空"
        SetHwVersionErr
        CheckHwVersion = false
    End If
End Function

Function CheckUpdateNote()
	If IsValidUpdateNote Then 
        SetUpdateNoteOK 
        CheckUpdateNote = true
    Else 
        TraceLog "更新说明填写有误"
        SetUpdateNoteErr
        CheckUpdateNote = false
    End If
End Function

Function CheckTimeZone()
	If IsValidTimeZone Then 
        SetTimeZoneOK 
        CheckTimeZone = true
    Else 
        TraceLog "时区不能为空"
        SetTimeZoneErr
        CheckTimeZone = false
    End If
End Function

Function CheckLanguage()
	If IsValidLanguage Then 
        SetLanguageOK 
        CheckLanguage = true
    Else 
        TraceLog "语言不能为空"
        SetLanguageErr
        CheckLanguage = false
    End If
End Function

Function CheckMactoolUpdateNote()
	If IsValidMactoolUpdateNote Then 
        SetMactoolUpdateNoteOK 
        CheckMactoolUpdateNote = true
    Else 
        TraceLog "mac工具更新说明填写有误"
        SetMactoolUpdateNoteErr
        CheckMactoolUpdateNote = false
    End If
End Function

Function CheckUpdateReason()
	If IsValidUpdateReasonIndex Then 
        SetUpdateReasonOK 
        CheckUpdateReason = true
    Else 
        TraceLog "mac工具升级原因选择有误"
        SetUpdateReasonErr
        CheckUpdateReason = false
    End If
End Function

Function CheckMactoolUpdateReason()
	If IsValidMactoolUpdateReasonIndex Then 
        SetMactoolUpdateReasonOK 
        CheckMactoolUpdateReason = true
    Else 
        TraceLog "mac工具升级原因选择有误"
        SetMactoolUpdateReasonErr
        CheckMactoolUpdateReason = false
    End If
End Function

Function CheckRfFreq()
	If IsValidRfFreq Then 
        SetRfFreqOK 
        CheckRfFreq = true
    Else 
        TraceLog "RF频率填写有误"
        SetRfFreqErr
        CheckRfFreq = false
    End If
End Function

//////////////////////////////////
// Version Relations Function
Function SetPDMToolVersion(version)
    FormGlobal.LabelVersion.Caption = "版本: " + version
End Function

//////////////////////////////////
// Button Relations Function
Function EnableBtnOK()
    FormGlobal.BtnOK.Enabled = true
End Function

Function DisableBtnOK()
    FormGlobal.BtnOK.Enabled = false
End Function

Function EnableBtnReset()
    FormGlobal.BtnReset.Enabled = true
End Function

Function DisableBtnReset()
    FormGlobal.BtnReset.Enabled = false
End Function

Function EnableBtnSelectFile()
    FormGlobal.BtnSelectFile.Enabled = true
End Function

Function DisableBtnSelectFile()
    FormGlobal.BtnSelectFile.Enabled = false
End Function

Function EnableBtnSelectMacTool()
    FormGlobal.BtnSelectMacTool.Enabled = true
End Function

Function DisableBtnSelectMacTool()
    FormGlobal.BtnSelectMacTool.Enabled = false
End Function

//////////////////////////////////
// Device Relations Function
Function SetDeviceList(deviceList)
    FormGlobal.ComboxDevice.List = deviceList
End Function

Function GetDeviceIndex()
    GetDeviceIndex = FormGlobal.ComboxDevice.ListIndex
End Function

Function IsValidDeviceIndex()
    Dim deviceIndex
    deviceIndex = FormGlobal.ComboxDevice.ListIndex
    If 0 > deviceIndex Then
        IsValidDeviceIndex = false
    ElseIf DEIVCE_LIST_NUM <= deviceIndex Then
        IsValidDeviceIndex = false
    Else 
        IsValidDeviceIndex = true
    End If
End Function

Function GetDeviceName()
    Dim deviceList
    deviceList = Split(FormGlobal.ComboxDevice.List, "|")
    GetDeviceName = deviceList(FormGlobal.ComboxDevice.ListIndex)
End Function

Function SetDeviceOK()
    FormGlobal.ComboxDevice.NormalColor = "1BA154"
End Function

Function SetDeviceErr()
    FormGlobal.ComboxDevice.NormalColor = "0000FF"
End Function

Function SetDeviceNormal()
    FormGlobal.ComboxDevice.NormalColor = "A0A0A4"
End Function

Function ResetDevice()
    SetDeviceNormal 
	
    FormGlobal.ComboxDevice.ListIndex = DEVICE_ID_INVALID
End Function

//////////////////////////////////
// GroupBox Relations Function
Function SetGroupBoxInfo(deviceName)
    FormGlobal.GroupBoxInfo.Caption = "请填写" + deviceName + "机型相关信息"
End Function

Function ResetGroupBoxInfo()
    FormGlobal.GroupBoxInfo.Caption = "请先选择机型"
End Function

//////////////////////////////////
// SelectFile Relations Function
Function ResetSelecteFile()
    SetSelectedFileNormal 
	
    FormGlobal.LabelSelectedFile.Caption = TIPS_SELECT_FILE
    FormGlobal.LabelSelectedFile.Visible = false
    FormGlobal.BtnSelectFile.Visible = false	
End Function

Function ShowSelectFile()
    FormGlobal.LabelSelectedFile.Visible = true
    FormGlobal.BtnSelectFile.Visible = true
End Function

Function SetSelectedFile(filePath)
    FormGlobal.LabelSelectedFile.Caption = filePath
End Function

Function GetSelectedFile()
    GetSelectedFile = FormGlobal.LabelSelectedFile.Caption
End Function

Function IsValidSelectedFile()
    Dim filePath
    filePath = GetSelectedFile
    If filePath = TIPS_SELECT_FILE Then 
        IsValidSelectedFile = false
    ElseIf false = Plugin.File.IsFileExist(filePath) Then
        IsValidSelectedFile = false
    ElseIf false = IsValidDeviceIndex Then 
        IsValidSelectedFile = false	
    Else 
        // 增加正则匹配文件名是否合法
        Dim fileName, deviceNameL
        fileName = GetFileName(filePath)
        deviceNameL = LCase(GetDeviceName)

        Dim regEx, matches, matched
        Set regEx = New RegExp
        regEx.Pattern = "^" + deviceNameL + "-([0-9]{1,4}\.){3}[0-9]{1,4}-[0-9a-zA-Z]{1,}[_]{0,1}[0-9a-zA-Z]{0,}.img$"

        Set matches = regEx.Execute(fileName)
        If 1 <> matches.Count Then 
            IsValidSelectedFile = false
            Exit Function
        End If
		
        matched = matches(0)
        If matched = fileName Then 
            IsValidSelectedFile = true
        Else 
            IsValidSelectedFile = false	
        End If
    End If
End Function

Function SetSelectedFileOK()
    FormGlobal.LabelSelectedFile.TextColor = "1BA154"
End Function

Function SetSelectedFileErr()
    FormGlobal.LabelSelectedFile.TextColor = "0000FF"
End Function

Function SetSelectedFileNormal()
    FormGlobal.LabelSelectedFile.TextColor = "808080"
End Function

//////////////////////////////////
// SelectMacTools Relations Function
Function ResetSelecteMacTool()
    SetSelectedMacToolNormal
	
    FormGlobal.LabelSelectedMacTool.Caption = TIPS_SELECT_MACTOOL
    FormGlobal.LabelSelectedMacTool.Visible = false
    FormGlobal.BtnSelectMacTool.Visible = false	
End Function

Function ShowSelectMacTool()
    FormGlobal.LabelSelectedMacTool.Visible = true
    FormGlobal.BtnSelectMacTool.Visible = true
End Function

Function SetSelectedMacTool(filePath)
    FormGlobal.LabelSelectedMacTool.Caption = filePath
End Function

Function GetSelectedMacTool()
    GetSelectedMacTool = FormGlobal.LabelSelectedMacTool.Caption
End Function

Function IsValidSelectedMacTool()
    Dim macToolPath
    macToolPath = GetSelectedMacTool
    If macToolPath = TIPS_SELECT_MACTOOL Then 
        IsValidSelectedMacTool = false
    ElseIf false = Plugin.File.IsFileExist(macToolPath) Then
        IsValidSelectedMacTool = false
    ElseIf false = IsValidDeviceIndex Then 
        IsValidSelectedMacTool = false	
    Else 
        // 增加正则匹配文件名是否合法
        Dim fileName, deviceNameL
        fileName = GetFileName(macToolPath)
        deviceNameL = LCase(GetDeviceName)

        Dim regEx, matches, matched
        Set regEx = New RegExp
        regEx.Pattern = "^mac_tool_" + deviceNameL + "-([0-9]{1,4}\.){3}[0-9]{1,4}.zip$"

        Set matches = regEx.Execute(fileName)
        If 1 <> matches.Count Then 
            IsValidSelectedMacTool = false
            Exit Function
        End If
		
        matched = matches(0)
        If matched = fileName Then 
            IsValidSelectedMacTool = true
        Else 
            IsValidSelectedMacTool = false	
        End If
    End If
End Function

Function SetSelectedMacToolOK()
    FormGlobal.LabelSelectedMacTool.TextColor = "1BA154"
End Function

Function SetSelectedMacToolErr()
    FormGlobal.LabelSelectedMacTool.TextColor = "0000FF"
End Function

Function SetSelectedMacToolNormal()
    FormGlobal.LabelSelectedMacTool.TextColor = "808080"
End Function

//////////////////////////////////
// Input Relations Function
Function ResetProductName()
    SetProductNameNormal
	
    FormGlobal.LabelProductName.Caption = TIPS_INPUT_PRODUCT_NAME
    FormGlobal.LabelProductName.Visible = false
    FormGlobal.InputProductName.Text = ""	
    FormGlobal.InputProductName.Visible = false	
End Function

Function ShowProductName()
	SetProductNameNormal 
	
    FormGlobal.LabelProductName.Visible = true
    FormGlobal.InputProductName.Visible = true
End Function

Function GetProductName()
    GetProductName = FormGlobal.InputProductName.Text
End Function

Function GetProductNameTrim(productName)
	Dim regEx, matches, matched
    Set regEx = New RegExp
    regEx.Pattern = "V[PG]{0,1}-.*版"
    Set matches = regEx.Execute(productName)
    If 1 <> matches.Count Then 
        GetProductNameTrim = "Unknown"
        Exit Function
    End If
    GetProductNameTrim = matches(0)
End Function

Function IsValidProductName()
    Dim productName
    productName = GetProductName
    
    If "" = productName Then 
    	IsValidProductName = false
    	Exit Function
    End If
	
    IsValidProductName = true
End Function

Function SetProductNameOK()
    FormGlobal.LabelProductName.TextColor = "1BA154"
    FormGlobal.InputProductName.NormalColor = "1BA154"
End Function

Function SetProductNameErr()
    FormGlobal.LabelProductName.TextColor = "0000FF"
    FormGlobal.InputProductName.NormalColor = "0000FF"
End Function

Function SetProductNameNormal()
    FormGlobal.LabelProductName.TextColor = "808080"
    FormGlobal.InputProductName.NormalColor = "808080"
End Function

Function ResetBoardName()
    SetBoardNameNormal
	
    FormGlobal.LabelBoardName.Caption = TIPS_INPUT_BOARD_NAME
    FormGlobal.LabelBoardName.Visible = false
    FormGlobal.InputBoardName.Text = ""	
    FormGlobal.InputBoardName.Visible = false	
End Function

Function ShowBoardName()
	SetBoardNameNormal 
	
    FormGlobal.LabelBoardName.Visible = true
    FormGlobal.InputBoardName.Visible = true
End Function

Function GetBoardName()
    GetBoardName = FormGlobal.InputBoardName.Text
End Function

Function IsValidBoardName()
    Dim boardName
    boardName = GetBoardName
    
    If "" = boardName Then 
    	IsValidBoardName = false
    	Exit Function
    End If
	
    IsValidBoardName = true
End Function

Function SetBoardNameOK()
    FormGlobal.LabelBoardName.TextColor = "1BA154"
    FormGlobal.InputBoardName.NormalColor = "1BA154"
End Function

Function SetBoardNameErr()
    FormGlobal.LabelBoardName.TextColor = "0000FF"
    FormGlobal.InputBoardName.NormalColor = "0000FF"
End Function

Function SetBoardNameNormal()
    FormGlobal.LabelBoardName.TextColor = "808080"
    FormGlobal.InputBoardName.NormalColor = "808080"
End Function

Function ResetRfFreq()
    SetRfFreqNormal
	
    FormGlobal.LabelRfFreq.Caption = TIPS_INPUT_RF_FREQ
    FormGlobal.LabelRfFreq.Visible = false
    FormGlobal.InputRfFreq.Text = ""	
    FormGlobal.InputRfFreq.Visible = false	
End Function

Function ShowRfFreq()
    FormGlobal.LabelRfFreq.Visible = true
    FormGlobal.InputRfFreq.Visible = true
End Function

Function GetRfFreq()
    GetRfFreq = FormGlobal.InputRfFreq.Text
End Function

Function IsValidRfFreq()
    Dim freq
    freq = GetRfFreq
    
    Dim regEx, matches, matched
    Set regEx = New RegExp
    regEx.Pattern = "^[0-9]{0,}$"
    Set matches = regEx.Execute(freq)
    If 1 <> matches.Count Then 
        IsValidRfFreq = false
        Exit Function
    End If
	
    IsValidRfFreq = true
End Function

Function SetRfFreqOK()
    FormGlobal.LabelRfFreq.TextColor = "1BA154"
    FormGlobal.InputRfFreq.NormalColor = "1BA154"
End Function

Function SetRfFreqErr()
    FormGlobal.LabelRfFreq.TextColor = "0000FF"
    FormGlobal.InputRfFreq.NormalColor = "0000FF"
End Function

Function SetRfFreqNormal()
    FormGlobal.LabelRfFreq.TextColor = "808080"
    FormGlobal.InputRfFreq.NormalColor = "808080"
End Function

Function ResetHwVersion()
    SetHwVersionNormal
	
    FormGlobal.LabelHwVersion.Caption = TIPS_INPUT_HW_VERSION
    FormGlobal.LabelHwVersion.Visible = false
    FormGlobal.InputHwVersion.Text = ""	
    FormGlobal.InputHwVersion.Visible = false	
End Function

Function ShowHwVersion()
	SetHwVersionNormal 
	
    FormGlobal.LabelHwVersion.Visible = true
    FormGlobal.InputHwVersion.Visible = true
End Function

Function GetHwVersion()
    GetHwVersion = FormGlobal.InputHwVersion.Text
End Function

Function IsValidHwVersion()
    Dim hwVersion
    hwVersion = GetHwVersion
    
    If "" = hwVersion Then 
    	IsValidHwVersion = false
    	Exit Function
    End If
	
    IsValidHwVersion = true
End Function

Function SetHwVersionOK()
    FormGlobal.LabelHwVersion.TextColor = "1BA154"
    FormGlobal.InputHwVersion.NormalColor = "1BA154"
End Function

Function SetHwVersionErr()
    FormGlobal.LabelHwVersion.TextColor = "0000FF"
    FormGlobal.InputHwVersion.NormalColor = "0000FF"
End Function

Function SetHwVersionNormal()
    FormGlobal.LabelHwVersion.TextColor = "808080"
    FormGlobal.InputHwVersion.NormalColor = "808080"
End Function

Function ResetUpdateNote()
    SetUpdateNoteNormal
	
    FormGlobal.LabelUpdateNote.Caption = TIPS_INPUT_UPDATE_NOTE
    FormGlobal.LabelUpdateNote.Visible = false
    FormGlobal.InputUpdateNote.Text = ""	
    FormGlobal.InputUpdateNote.Visible = false	
End Function

Function ShowUpdateNote()
	SetUpdateNoteNormal 
	
    FormGlobal.LabelUpdateNote.Visible = true
    FormGlobal.InputUpdateNote.Visible = true
End Function

Function GetUpdateNote()
    GetUpdateNote = FormGlobal.InputUpdateNote.Text
End Function

Function IsValidUpdateNote()
    IsValidUpdateNote = true
End Function

Function SetUpdateNoteOK()
    FormGlobal.LabelUpdateNote.TextColor = "1BA154"
    FormGlobal.InputUpdateNote.NormalColor = "1BA154"
End Function

Function SetUpdateNoteErr()
    FormGlobal.LabelUpdateNote.TextColor = "0000FF"
    FormGlobal.InputUpdateNote.NormalColor = "0000FF"
End Function

Function SetUpdateNoteNormal()
    FormGlobal.LabelUpdateNote.TextColor = "808080"
    FormGlobal.InputUpdateNote.NormalColor = "808080"
End Function

Function ResetMactoolUpdateNote()
    SetMactoolUpdateNoteNormal
	
    FormGlobal.LabelMactoolUpdateNote.Caption = TIPS_INPUT_MACTOOL_UPDATE_NOTE
    FormGlobal.LabelMactoolUpdateNote.Visible = false
    FormGlobal.InputMactoolUpdateNote.Text = ""	
    FormGlobal.InputMactoolUpdateNote.Visible = false	
End Function

Function ShowMactoolUpdateNote()
	SetMactoolUpdateNoteNormal 
	
    FormGlobal.LabelMactoolUpdateNote.Visible = true
    FormGlobal.InputMactoolUpdateNote.Visible = true
End Function

Function GetMactoolUpdateNote()
    GetMactoolUpdateNote = FormGlobal.InputMactoolUpdateNote.Text
End Function

Function IsValidMactoolUpdateNote()
    IsValidMactoolUpdateNote = true
End Function

Function SetMactoolUpdateNoteOK()
    FormGlobal.LabelMactoolUpdateNote.TextColor = "1BA154"
    FormGlobal.InputMactoolUpdateNote.NormalColor = "1BA154"
End Function

Function SetMactoolUpdateNoteErr()
    FormGlobal.LabelMactoolUpdateNote.TextColor = "0000FF"
    FormGlobal.InputMactoolUpdateNote.NormalColor = "0000FF"
End Function

Function SetMactoolUpdateNoteNormal()
    FormGlobal.LabelMactoolUpdateNote.TextColor = "808080"
    FormGlobal.InputMactoolUpdateNote.NormalColor = "808080"
End Function

Function ResetTimeZone()
    SetTimeZoneNormal
	
    FormGlobal.LabelTimeZone.Caption = TIPS_INPUT_TIME_ZONE
    FormGlobal.LabelTimeZone.Visible = false
    FormGlobal.InputTimeZone.Text = ""	
    FormGlobal.InputTimeZone.Visible = false	
End Function

Function ShowTimeZone()
	SetTimeZoneNormal 
	
    FormGlobal.LabelTimeZone.Visible = true
    FormGlobal.InputTimeZone.Visible = true
End Function

Function GetTimeZone()
    GetTimeZone = FormGlobal.InputTimeZone.Text
End Function

Function IsValidTimeZone()
	Dim timezone
    timezone = GetTimeZone()
    
    If "" = timezone Then 
    	IsValidTimeZone = false
    	Exit Function
    End If
	
    IsValidTimeZone = true
End Function

Function SetTimeZoneOK()
    FormGlobal.LabelTimeZone.TextColor = "1BA154"
    FormGlobal.InputTimeZone.NormalColor = "1BA154"
End Function

Function SetTimeZoneErr()
    FormGlobal.LabelTimeZone.TextColor = "0000FF"
    FormGlobal.InputTimeZone.NormalColor = "0000FF"
End Function

Function SetTimeZoneNormal()
    FormGlobal.LabelTimeZone.TextColor = "808080"
    FormGlobal.InputTimeZone.NormalColor = "808080"
End Function

Function ResetLanguage()
    SetLanguageNormal
	
    FormGlobal.LabelLanguage.Caption = TIPS_INPUT_LANGUAGE
    FormGlobal.LabelLanguage.Visible = false
    FormGlobal.InputLanguage.Text = ""	
    FormGlobal.InputLanguage.Visible = false	
End Function

Function ShowLanguage()
	SetLanguageNormal 
	
    FormGlobal.LabelLanguage.Visible = true
    FormGlobal.InputLanguage.Visible = true
End Function

Function GetLanguage()
    GetLanguage = FormGlobal.InputLanguage.Text
End Function

Function IsValidLanguage()
	Dim language
    language = GetLanguage()
    
    If "" = language Then 
    	IsValidLanguage = false
    	Exit Function
    End If
	
    IsValidLanguage = true
End Function

Function SetLanguageOK()
    FormGlobal.LabelLanguage.TextColor = "1BA154"
    FormGlobal.InputLanguage.NormalColor = "1BA154"
End Function

Function SetLanguageErr()
    FormGlobal.LabelLanguage.TextColor = "0000FF"
    FormGlobal.InputLanguage.NormalColor = "0000FF"
End Function

Function SetLanguageNormal()
    FormGlobal.LabelLanguage.TextColor = "808080"
    FormGlobal.InputLanguage.NormalColor = "808080"
End Function

Function ResetUpdateReason()
    SetUpdateReasonNormal
	
    FormGlobal.LabelUpdateReason.Caption = TIPS_INPUT_UPDATE_REASON
    FormGlobal.LabelUpdateReason.Visible = false
    FormGlobal.ComboxUpdateReason.List = UPDATE_REASON_ID_LIST
	FormGlobal.ComboxUpdateReason.ListIndex = UPDATE_REASON_ID_INVALID
    FormGlobal.ComboxUpdateReason.Visible = false	
End Function

Function ShowUpdateReason()
	SetUpdateReasonNormal 
	
    FormGlobal.LabelUpdateReason.Visible = true
    FormGlobal.ComboxUpdateReason.Visible = true
End Function

Function GetUpdateReasonIndex()
    GetUpdateReasonIndex = FormGlobal.ComboxUpdateReason.ListIndex
End Function

Function IsValidUpdateReasonIndex()
    Dim reasonIndex
    reasonIndex = FormGlobal.ComboxUpdateReason.ListIndex
    If 0 > reasonIndex Then
        IsValidUpdateReasonIndex = false
    ElseIf UPDATE_REASON_LIST_NUM <= reasonIndex Then
        IsValidUpdateReasonIndex = false
    Else 
        IsValidUpdateReasonIndex = true
    End If
End Function

Function GetUpdateReason()
    Dim reasonList
    reasonList = Split(FormGlobal.ComboxUpdateReason.List, "|")
    GetUpdateReason = reasonList(FormGlobal.ComboxUpdateReason.ListIndex)
End Function

Function SetUpdateReasonOK()
    FormGlobal.LabelUpdateReason.TextColor = "1BA154"
    FormGlobal.ComboxUpdateReason.NormalColor = "1BA154"
End Function

Function SetUpdateReasonErr()
    FormGlobal.LabelUpdateReason.TextColor = "0000FF"
    FormGlobal.ComboxUpdateReason.NormalColor = "0000FF"
End Function

Function SetUpdateReasonNormal()
    FormGlobal.LabelUpdateReason.TextColor = "808080"
    FormGlobal.ComboxUpdateReason.NormalColor = "808080"
End Function

Function ResetMactoolUpdateReason()
    SetMactoolUpdateReasonNormal
	
    FormGlobal.LabelMactoolUpdateReason.Caption = TIPS_INPUT_MACTOOL_UPDATE_REASON
    FormGlobal.LabelMactoolUpdateReason.Visible = false
    FormGlobal.ComboxMactoolUpdateReason.List = MACTOOL_UPDATE_REASON_ID_LIST
	FormGlobal.ComboxMactoolUpdateReason.ListIndex = MACTOOL_UPDATE_REASON_ID_INVALID
    FormGlobal.ComboxMactoolUpdateReason.Visible = false	
End Function

Function ShowMactoolUpdateReason()
	SetMactoolUpdateReasonNormal 
	
    FormGlobal.LabelMactoolUpdateReason.Visible = true
    FormGlobal.ComboxMactoolUpdateReason.Visible = true
End Function

Function GetMactoolUpdateReasonIndex()
    GetMactoolUpdateReasonIndex = FormGlobal.ComboxMactoolUpdateReason.ListIndex
End Function

Function IsValidMactoolUpdateReasonIndex()
    Dim reasonIndex
    reasonIndex = FormGlobal.ComboxMactoolUpdateReason.ListIndex
    If 0 > reasonIndex Then
        IsValidMactoolUpdateReasonIndex = false
    ElseIf MACTOOL_UPDATE_REASON_LIST_NUM <= reasonIndex Then
        IsValidMactoolUpdateReasonIndex = false
    Else 
        IsValidMactoolUpdateReasonIndex = true
    End If
End Function

Function GetMactoolUpdateReason()
    Dim reasonList
    reasonList = Split(FormGlobal.ComboxMactoolUpdateReason.List, "|")
    GetMactoolUpdateReason = reasonList(FormGlobal.ComboxMactoolUpdateReason.ListIndex)
End Function

Function SetMactoolUpdateReasonOK()
    FormGlobal.LabelMactoolUpdateReason.TextColor = "1BA154"
    FormGlobal.ComboxMactoolUpdateReason.NormalColor = "1BA154"
End Function

Function SetMactoolUpdateReasonErr()
    FormGlobal.LabelMactoolUpdateReason.TextColor = "0000FF"
    FormGlobal.ComboxMactoolUpdateReason.NormalColor = "0000FF"
End Function

Function SetMactoolUpdateReasonNormal()
    FormGlobal.LabelMactoolUpdateReason.TextColor = "808080"
    FormGlobal.ComboxMactoolUpdateReason.NormalColor = "808080"
End Function

//////////////////////////////////
// Word Relations Function
Function BuildKeyWordsMap(userName, model, oem, version, hwVersion, mactoolVersion, productName, productNameTrim, boardName, _
    	fileName, fileTime, fileMD5, fileSizeReadableMB, fileSizeReadableByte, _
    	mactoolName, mactoolTime, mactoolMD5, mactoolSizeReadableMB, mactoolSizeReadableByte)
	
	gKeywordsMapSize = 0
	
	// Common
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${userName}"
    map(1, gKeywordsMapSize) = userName
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${modelL}"
    map(1, gKeywordsMapSize) = LCase(model)
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${modelU}"
    map(1, gKeywordsMapSize) = UCase(model)
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${oemL}"
    map(1, gKeywordsMapSize) = LCase(oem)
	gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${oemU}"
    map(1, gKeywordsMapSize) = UCase(oem)
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${version}"
    map(1, gKeywordsMapSize) = version
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${hwVersion}"
    map(1, gKeywordsMapSize) = hwVersion
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolVersion}"
    map(1, gKeywordsMapSize) = mactoolVersion
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${productName}"
    map(1, gKeywordsMapSize) = productName
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${productNameTrim}"
    map(1, gKeywordsMapSize) = productNameTrim
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${boardName}"
    map(1, gKeywordsMapSize) = boardName
    gKeywordsMapSize = gKeywordsMapSize + 1
    
    // img
    ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${fileName}"
    map(1, gKeywordsMapSize) = fileName
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${fileTime}"
    map(1, gKeywordsMapSize) = fileTime
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${fileMD5}"
    map(1, gKeywordsMapSize) = fileMD5
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${fileSizeReadableMB}"
    map(1, gKeywordsMapSize) = fileSizeReadableMB
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${fileSizeReadableByte}"
    map(1, gKeywordsMapSize) = fileSizeReadableByte
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	// mactool
	ReDim Preserve map(2, gKeywordsMapSize + 1)
	map(0, gKeywordsMapSize) = "${mactoolName}"
    map(1, gKeywordsMapSize) = mactoolName
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolTime}"
    map(1, gKeywordsMapSize) = mactoolTime
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolMD5}"
    map(1, gKeywordsMapSize) = mactoolMD5
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolSizeReadableMB}"
    map(1, gKeywordsMapSize) = mactoolSizeReadableMB
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolSizeReadableByte}"
    map(1, gKeywordsMapSize) = mactoolSizeReadableByte
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	// 非关键信息, 直接从这里读取
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${updateNote}"
    map(1, gKeywordsMapSize) = GetUpdateNote()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${updateReason}"
    map(1, gKeywordsMapSize) = GetUpdateReason()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${timezone}"
    map(1, gKeywordsMapSize) = GetTimeZone()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${language}"
    map(1, gKeywordsMapSize) = GetLanguage()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolUpdateNote}"
    map(1, gKeywordsMapSize) = GetMactoolUpdateNote()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
	ReDim Preserve map(2, gKeywordsMapSize + 1)
    map(0, gKeywordsMapSize) = "${mactoolUpdateReason}"
    map(1, gKeywordsMapSize) = GetMactoolUpdateReason()
    gKeywordsMapSize = gKeywordsMapSize + 1
	
    BuildKeyWordsMap = map
End Function

Function BuildKeyWordsMapByDevice()
	Dim deviceID
    deviceID = GetDeviceIndex
    
    Select Case deviceID
    Case DEVICE_ID_R47G
    	
    Case DEVICE_ID_R48G
    	gKeywordsMapSizeByDevice = 2 
        Redim mapByDevice(2, gKeywordsMapSizeByDevice)
                
        mapByDevice(0, 0) = "${rfFreq}"
        mapByDevice(1, 0) = GetRfFreq()
        
        mapByDevice(0, 1) = "${rfFreqWithSymbol}"
        If "" = mapByDevice(1, 0) Then 
        	mapByDevice(1, 1) = ""
        Else
        	mapByDevice(1, 1) = "-rf" + mapByDevice(1, 0)
        End If
        
    Case DEVICE_ID_R49P
			
    Case Else

    End Select
    
    BuildKeyWordsMapByDevice = mapByDevice
End Function

Function DoGenerateWordDoc(curPath, keyWordsMap, keyWordsMapByDevice)
    Const DEVICE_WORD_TEMPLATE_PATH = "\templates"
    Const DEVICE_WORD_OUTPUT_PATH = "\outputs"
    Const DEVICE_R47G_WORD_TEMPLATE_LIST = "工程文件发行.doc|Mac烧写工具.doc"
    Const DEVICE_R48G_WORD_TEMPLATE_LIST = "工程文件发行.doc|Mac烧写工具.doc"
	
    Dim deviceID, fileList, filePath, outputPath
    deviceID = GetDeviceIndex()
    Select Case deviceID
    Case DEVICE_ID_R47G
    	filePath = curPath + DEVICE_WORD_TEMPLATE_PATH + "\R47G\"
        fileList = Split(DEVICE_R47G_WORD_TEMPLATE_LIST, "|")
        outputPath = curPath + DEVICE_WORD_OUTPUT_PATH + "\R47G\"
        
    Case DEVICE_ID_R48G
        filePath = curPath + DEVICE_WORD_TEMPLATE_PATH + "\R48G\"
        fileList = Split(DEVICE_R48G_WORD_TEMPLATE_LIST, "|")
        outputPath = curPath + DEVICE_WORD_OUTPUT_PATH + "\R48G\"

    Case DEVICE_ID_R49P
        // Unsupport now
        DoGenerateWordDoc = false
        Exit Function
			
    Case Else
        DoGenerateWordDoc = false
        Exit Function
    End Select

    Dim wordApp, wordDocument, wordFinder, wordRange
    For i = 0 To UBound(fileList)
        // 合法性检查
        If false = Plugin.File.IsFileExist(filePath + fileList(i)) Then 
            TraceLog "模板文件[" + filePath + fileList(i) + "]不存在!"
            DoGenerateWordDoc = false
            Exit Function
        End If
		
        // 复制文件
        Plugin.File.CopyFile filePath + fileList(i), outputPath + fileList(i)
		
        // 替换关键字
        Set wordApp = CreateObject("Word.Application")
        Set wordDocument = wordApp.Documents.Open(outputPath + fileList(i))
		For Each wordRange In wordApp.ActiveDocument.StoryRanges
			Set finderObj = wordRange.Find
			For j = 0 To (gKeywordsMapSize - 1)
				finderObj.Execute keyWordsMap(0, j),"","","","","","","","", keyWordsMap(1, j), 2
			Next
			For j = 0 To (gKeywordsMapSizeByDevice - 1)
				finderObj.Execute keyWordsMapByDevice(0, j),"","","","","","","","", keyWordsMapByDevice(1, j), 2
			Next
        Next

		wordDocument.Save 
        wordApp.Quit
    Next
    DoGenerateWordDoc = true
End Function

Function DoGenerateExcelXls(curPath, keyWordsMap, keyWordsMapByDevice)
	Const DEVICE_EXCEL_TEMPLATE_PATH = "\templates"
    Const DEVICE_EXCEL_OUTPUT_PATH = "\outputs"
    Const DEVICE_R47G_EXCEL_TEMPLATE_LIST = "工程文件发行说明文件导入模板.xls|版本评估会会议决议模版.xls|Mac烧写工具软件说明文件导入模板.xls"
    Const DEVICE_R48G_EXCEL_TEMPLATE_LIST = "工程文件发行说明文件导入模板.xls|版本评估会会议决议模版.xls|Mac烧写工具软件说明文件导入模板.xls"
	
    Dim deviceID, fileList, filePath, outputPath
    deviceID = GetDeviceIndex()
    Select Case deviceID
    Case DEVICE_ID_R47G
        filePath = curPath + DEVICE_EXCEL_TEMPLATE_PATH + "\R47G\"
        fileList = Split(DEVICE_R47G_EXCEL_TEMPLATE_LIST, "|")
        outputPath = curPath + DEVICE_EXCEL_OUTPUT_PATH + "\R47G\"
        
    Case DEVICE_ID_R48G
        filePath = curPath + DEVICE_EXCEL_TEMPLATE_PATH + "\R48G\"
        fileList = Split(DEVICE_R48G_EXCEL_TEMPLATE_LIST, "|")
        outputPath = curPath + DEVICE_EXCEL_OUTPUT_PATH + "\R48G\"

    Case DEVICE_ID_R49P
        // Unsupport now
        DoGenerateExcelXls = false
        Exit Function
			
    Case Else
        DoGenerateExcelXls = false
        Exit Function
    End Select

	//Dim excelApp, sheets
	Dim excelApp, excelDocument, excelRange, finderObj
	For i = 0 To UBound(fileList)
		// 合法性检查
        If false = Plugin.File.IsFileExist(filePath + fileList(i)) Then 
            TraceLog "模板文件[" + filePath + fileList(i) + "]不存在!"
            DoGenerateExcelXls = false
            Exit Function
        End If
        
		// 复制文件
        Plugin.File.CopyFile filePath + fileList(i), outputPath + fileList(i)
        
        // 替换关键字
        // 替换关键字
        excelApp = Plugin.LazyOffice.ExcelOpen(outputPath + fileList(i), 0)
        sheets = Plugin.LazyOffice.SheetCount(excelApp)
		For sheet = 1 To sheets
			For j = 0 To (gKeywordsMapSize - 1)
				Plugin.LazyOffice.ExcelReplace sheet, keyWordsMap(0, j), keyWordsMap(1, j), "", false, false, excelApp
			Next
			For j = 0 To (gKeywordsMapSizeByDevice - 1)
				Plugin.LazyOffice.ExcelReplace sheet, keyWordsMapByDevice(0, j), keyWordsMapByDevice(1, j), "", false, false, excelApp
			Next
		Next
		
		Plugin.LazyOffice.ExcelSave (excelApp)	
		Plugin.LazyOffice.ExcelClose (excelApp)
 	Next

    DoGenerateExcelXls = true
End Function

//////////////////////////////////
// Common Function
Function ClearLog()
    FormGlobal.InputLog.text = ""
End Function

Function TraceLog(logContent)
    Dim logline
    logline = "日志" + "[" + CStr(Hour(now)) + ":" + CStr(Minute(now)) + ":" + CStr(Second(now)) + "]"
    logline = logline + ": " + CStr(logContent)

    FormGlobal.InputLog.text = FormGlobal.InputLog.text + vbcrlf + logline
End Function

Function Round(value, keep)
    If 0 <> InStr(value, ".") Then
        Dim integerPart, decimalPart
        integerPart = split(value, ".")(0)
        decimalPart = split(value, ".")(1)
        If Len(decimalPart) < keep Then 
            Round = integerPart & "." & String(keep - Len(decimalPart), "0")
        ElseIf Len(decimalPart) = keep Then   
            Round = value
        ElseIf Len(decimalPart) > keep Then
            Dim tmpLen, tmpValue
            If Mid(decimalPart, keep + 1, 1) >= 5 Then 
                If Len(decimalPart) = 1 Then 
                    Round = integerPart + 1
                Else 
                    tmpLen = Len(Left(decimalPart, keep))
                    tmpValue = Left(decimalPart, keep) + 1
                    If (Len(tmpValue) <> tmpLen) Then 
                        tmpValue = String(tmpLen - Len(tmpValue), "0") & tmpValue
                    End If
                    Round = integerPart & "." & tmpValue
                End If
            Else 
                If Len(decimalPart) = 1 Then 
                    Round = integerPart
                Else 
                    tmpLen = Len(Left(decimalPart, keep))
                    tmpValue = Left(decimalPart, keep) + 1
                    If (Len(tmpValue) <> tmpValue) Then 
                        tmpValue = String(tmpLen - Len(tmpValue), "0") & tmpValue
                    End If
                    Round = integerPart & "." & tmpValue
                End If
            End If
        End If
    Else 
        Round = value & "." & String(keep, "0")
    End If
End Function

Function TrimBytes(value)
    Dim comma, num, lenth
    Dim leftPart, rightPart
    lenth = Len(value)
	
    If lenth > 3 Then 
        For i = 3 To lenth step 3	
            leftPart = Left(value, lenth - i + ((i-3)/3))
            rightPart = right(value, i + ((i-3)/3))
            value = leftPart & "," & rightPart
        Next	
    End If
	
    TrimBytes = CStr(value)
End Function

Function GetFileName(filePath)
    Dim fso
    Set fso = CreateObject("Scripting.FileSystemObject")
    GetFileName = fso.GetFileName(filePath)
End Function

Function GetFileTime(filePath)
    Dim fso
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set fileObj = fso.GetFile(filePath)
    GetFileTime = CStr(fileObj.DateCreated)
End Function

Function GetModel(fileName)
    Dim regEx, matches
    Set regEx = New RegExp
    regEx.Pattern = "^r[4][789][gp]{0,1}"
    Set matches = regEx.Execute(fileName)
    If 1 <> matches.Count Then 
        GetModel = "Unknown"
        Exit Function
    End If
    GetModel = matches(0)
End Function

Function GetVersion(fileName)
    Dim regEx, matches
    Set regEx = New RegExp
    regEx.Pattern = "([0-9]{1,4}\.){3}[0-9]{1,4}"
    Set matches = regEx.Execute(fileName)
    If 1 <> matches.Count Then 
        GetVersion = "Unknown"
        Exit Function
    End If
    GetVersion = matches(0)
End Function

Function GetOem(fileName)
    Dim regEx, matches
    Set regEx = New RegExp
    regEx.Pattern = "-[0-9a-zA-Z]{1,}[_]{0,1}[0-9a-zA-Z]{0,}.img"
    Set matches = regEx.Execute(fileName)
    If 1 <> matches.Count Then 
        GetOem = "Unknown"
        Exit Function
    End If
	
    regEx.Pattern = "[0-9a-zA-Z]{1,}[_]{0,1}[0-9a-zA-Z]{0,}"
    Set matches = regEx.Execute(matches(0))
    If 1 <> matches.Count Then 
        GetOem = "Unknown"
        Exit Function
    End If
	
    GetOem = matches(0)
End Function

Function ResetAll()
    ResetDevice 
    ResetAllWithoutDevice
End Function

Function ResetAllWithoutDevice()
    ResetGroupBoxInfo 
    ResetSelecteFile 
    ResetSelecteMacTool 
    ResetProductName 
    ResetBoardName 
    ResetHwVersion 
    ResetUpdateNote 
    ResetMactoolUpdateNote
    ResetTimeZone 
    ResetLanguage 
    ResetUpdateReason
    ResetMactoolUpdateReason
    ResetRfFreq
End Function

Function DiableAll()
	DisableBtnOK 
    DisableBtnReset 
    DisableBtnSelectFile 
    DisableBtnSelectMacTool
End Function

Function EnableAll()
	EnableBtnSelectMacTool
    EnableBtnSelectFile
    EnableBtnReset 
    EnableBtnOK 
End Function

Function Generate()
    If true = gRunFlag Then 
        TraceLog "正在生成中..."
    Else 
    	
        gRunFlag = true
        BeginThread DoGenerate
    End If
End Function

//////////////////////////////////
// Common Sub, for Thread
Sub DoGenerate()
    DiableAll
		
    Dim filePath, fileName, fileTime, fileMD5, fileSize, fileSizeReadableByte, fileSizeReadableMB
    filePath = GetSelectedFile
    fileName = GetFileName(filePath)
    fileTime = GetFileTime(filePath)
    fileMD5 = Plugin.Encrypt.Md5File(filePath)
    fileSize = Plugin.File.GetFileLength(filePath)

    fileSizeReadableByte = TrimBytes(fileSize) + " 字节"
    fileSizeReadableMB = Round(fileSize/1024/1024, 1) + " MB"

	Dim userName
	userName = InputBox("请输入生成者的名字")

	Dim mactoolPath, mactoolName, mactoolTime, mactoolMD5, mactoolSize, mactoolSizeReadableByte, mactoolSizeReadableMB
	mactoolPath = GetSelectedMacTool
	mactoolName = GetFileName(mactoolPath)
	mactoolTime = GetFileTime(mactoolPath)
	mactoolMD5 = Plugin.Encrypt.Md5File(filePath)
    mactoolSize = Plugin.File.GetFileLength(filePath)
    mactoolSizeReadableByte = TrimBytes(fileSize) + " 字节"
    mactoolSizeReadableMB = Round(fileSize/1024/1024, 1) + " MB"

    Dim model, oem,  version, hwVersion, mactoolVersion, productName, productNameTrim, boardName
    model = GetModel(fileName)
    oem = GetOem(fileName)
    version = GetVersion(fileName)
    hwVersion = GetHwVersion()
    mactoolVersion = GetVersion(mactoolName)
    productName = GetProductName()
    productNameTrim = GetProductNameTrim(productName)
    boardName = GetBoardName()
    
    // 信息输出
    TraceLog "-----------关键信息-------------"
    TraceLog "机型 - " + model
    TraceLog "版本 - " + version
    TraceLog "硬件版本 - " + hwVersion
    TraceLog "mac工具版本 - " + mactoolVersion
    TraceLog "OEM - " + oem
    TraceLog "产品型号 - " + productName
    TraceLog "主板型号 - " + boardName
    TraceLog "------"
    TraceLog "img文件名称 - " + fileName
    TraceLog "img文件创建时间 - " + fileTime
    TraceLog "img文件MD5 - " + fileMD5
    TraceLog "img文件大小 - " + fileSizeReadableMB + "(" + fileSizeReadableByte + ")"
 	TraceLog "------"
 	TraceLog "mactool名称 - " + mactoolName
    TraceLog "mactool创建时间 - " + mactoolTime
    TraceLog "mactoolMD5 - " + mactoolMD5
    TraceLog "mactool大小 - " + mactoolSizeReadableMB + "(" + mactoolSizeReadableByte + ")" 
	TraceLog "------"
	
	
    Dim generateRes, keyWordsMap, keyWordsMapByDevice
    keyWordsMap = BuildKeyWordsMap(userName, model, oem, version, hwVersion, mactoolVersion, productName, productNameTrim, boardName, _
    	fileName, fileTime, fileMD5, fileSizeReadableMB, fileSizeReadableByte, _
    	mactoolName, mactoolTime, mactoolMD5, mactoolSizeReadableMB, mactoolSizeReadableByte)
    	
    keyWordsMapByDevice = BuildKeyWordsMapByDevice()
	
    // 根据模板生成Word文档
    generateRes = DoGenerateWordDoc(gRunPath, keyWordsMap, keyWordsMapByDevice)
    If false = generateRes Then 
        TraceLog "生成Word文件失败, 请检查模板文件及日志信息!"
        EnableAll
        Exit Sub
    End If
	
    // 根据模板生成Excel文档
    generateRes = DoGenerateExcelXls(gRunPath, keyWordsMap, keyWordsMapByDevice)
    If false = generateRes Then 
        TraceLog "生成Excel文件失败, 请检查模板文件及日志信息!"
        EnableAll
        Exit Sub
    End If
    
    // 结束
    TraceLog "生成结束, 请审核outputs文件夹中内容!"
	
	EnableAll
    gRunFlag = false
End Sub

